# Usage guide

## Prerequisites

- Python 3.6+
  - [requests](https://pypi.org/project/requests/)
  - [toml](https://pypi.org/project/toml/)
- [Miri](https://github.com/rust-lang/miri)
- [Crux](https://github.gatech.edu/ybae38/Crux)
- [sccache](https://github.com/mozilla/sccache)
  - Technically it can be optional, but I was lazy.
  - `sccache` should be on `PATH`
- `./setup.sh`

## Configuration

Copy `config.toml.template` to `config.toml` and fill it with your own data.

## Metadata Format

### target

- **crate**: (string) the name of the crate
- **version**: (string) the version to test the poc
- **peer**: (object array) peer dependencies, follows the same pattern with target. See `./poc/0004-rocket.rs` for an example. (optional)

### test

- **analyzers**: (string array) an array of analyzers that are expected to report bugs for this crate
  - manual, UnsafeDestructor
- **cargo_flags**: (string array) Cargo flags to append, for example `["--release"]` (optional)
- **cargo_toolchain**: (string) Specify the compiler toolchain if necessary (optional)

### report

- **title**: (string) issue title
- **description**: (string) issue description
- **code_snippets**: (array) code snippets that will be only included in the issue report (array)
- **patched**: (string array) RustSec `versions.patched`
- **unaffected**: (string array) RustSec `versions.unaffected` (optional)
- **informational**: (string) RustSec `informational` field. Default value is set to "unsound". Remove this line if the bug deserves a security advisory.
- **issue_url**: (string) original repository issue URL (autogenerated, optional)
- **issue_date**: (date) disclosure date (autogenerated **OR** manual)
- **rustsec_url**: (string) RustSec PR URL (autogenerated)
- **rustsec_id**: (string) RustSec ID (autogenerated)

## Workflow

### 1. PoC generation

```shell
./poc.py add <crate> <version>
```

### 2. PoC testing

Fill in the metadata section and complete the PoC code.

```shell
./poc.py run <PoC ID>
```

### 3. Issue reporting (WIP)

```shell
# Reporting can be done at once...
# reports the issue both to the crate's repository and RustSec
./poc.py report <PoC ID>

# ... or separately
# reports the issue only to the crate's repository
./poc.py report --crate_repo <PoC ID>
# and then later reports to RustSec
./poc.py report --rustsec <PoC ID>
```

Reporting Guideline:

- If the crate seems unmaintained, reports both to the crate's repository and RustSec
- Otherwise, report to the crate's repository first and wait for the developer to confirm
